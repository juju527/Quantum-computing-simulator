# Shor算法详解

## 算法概述

Shor算法是由数学家Peter Shor于1994年提出的量子算法，用于解决整数分解问题。该算法展示了量子计算机在特定问题上相对于经典计算机的指数级优势，是量子计算领域最重要的里程碑之一。

### 算法目标

给定一个合数$N = p \times q$，Shor算法的目标即找到$N$的非平凡因子$p$和$q$。

## 数学基础

### 周期函数与整数分解

Shor算法的核心思想是将整数分解问题转化为周期查找问题。考虑函数：

$f(x) = a^x \mod N$

其中：
- $N$是要分解的合数
- $a$是与$N$互质的随机整数（$1 < a < N$）
- $x$是非负整数

这个函数具有周期性，即存在最小正整数$r$，使得$f(x+r) = f(x)$对所有$x$成立。这个$r$称为函数的周期。

### 周期与因子的关系

如果找到周期$r$，并且满足以下条件：
1. $r$是偶数
2. $a^{r/2} \neq -1 \mod N$

那么可以计算出$N$的因子：
- $p = \gcd(a^{r/2} - 1, N)$
- $q = \gcd(a^{r/2} + 1, N)$

这是因为：
$$a^r \equiv 1 \mod N \implies (a^{r/2} - 1)(a^{r/2} + 1) \equiv 0 \mod N$$
已知$a^{r/2} \neq 1 \mod N$且$a^{r/2} \neq -1 \mod N$，又因为$N$必然整除$(a^{r/2} - 1)(a^{r/2} + 1)$，所以这两个数分别包含$N$的两个非平凡因子，利用最大公约数计算即可得到因子$p$和$q$。

### 量子傅里叶变换

量子傅里叶变换(QFT)是Shor算法的关键组件，它能够高效地找到周期函数的周期。QFT将周期性从时域转换到频域，使得测量结果中包含周期信息。

## 算法原理

### 整体流程

Shor算法分为两个主要部分：

1. **经典部分**：
   - 选择与$N$互质的基数$a$
   - 检查$a$是否为$N$的因子（如果是，直接得到结果）
   - 量子计算后的经典后处理

2. **量子部分**：
   - 创建量子叠加态
   - 应用模幂运算
   - 执行量子傅里叶变换
   - 测量并获取周期信息

## 量子实现步骤

### 步骤1：量子态初始化

初始化两个量子寄存器：
- 第一寄存器：$m$个量子比特，用于存储$x$值
- 第二寄存器：$n$个量子比特，用于存储函数值$f(x)$

初始状态：$|\psi_0\rangle = |0\rangle^{\otimes m} |0\rangle^{\otimes n}$

### 步骤2：叠加态创建

对第一寄存器应用Hadamard门，创建均匀叠加态：

$$|\psi_1\rangle = \frac{1}{\sqrt{Q}} \sum_{x=0}^{Q-1} |x\rangle |0\rangle$$

其中$Q = 2^m$是第一寄存器的状态数。

### 步骤3：量子模幂运算

应用受控模幂运算$U_a$：

$$U_a: |x\rangle|y\rangle \rightarrow |x\rangle|y \oplus a^x \mod N\rangle$$

执行后的状态：

$$|\psi_2\rangle = \frac{1}{\sqrt{Q}} \sum_{x=0}^{Q-1} |x\rangle|a^x \mod N\rangle$$

也就是说，可能的寄存器状态即为所有$x$与对应的$f(x)$值的叠加。

### 步骤4：测量第二寄存器

对第二寄存器进行测量，得到某个函数值$y_0 = a^{x_0} \mod N$。测量后，量子态坍缩为：

$$|\psi_3\rangle = \frac{1}{\sqrt{M}} \sum_{k=0}^{M-1} |x_0 + kr\rangle |y_0\rangle$$

其中$r$是函数的周期，$M \approx Q/r$。

### 步骤5：量子傅里叶变换

对第一寄存器应用量子傅里叶变换：

$$\text{QFT}: |x\rangle \rightarrow \frac{1}{\sqrt{Q}} \sum_{c=0}^{Q-1} e^{2\pi i xc/Q} |c\rangle$$

变换后的状态包含周期$r$的信息，测量结果$c$很可能接近$kQ/r$。

在步骤4测量第二寄存器得到固定的 $y_0$ 后，第一寄存器的态为
$$
|\psi_3\rangle = \frac{1}{\sqrt{M}}\sum_{k=0}^{M-1}|x_0 + k r\rangle,
$$
对第一寄存器施加QFT后，得到每个基态 $|c\rangle$ 的振幅为
$$
A(c)=\frac{1}{\sqrt{QM}}\sum_{k=0}^{M-1}e^{2\pi i (x_0+kr)c/Q}
= \frac{e^{2\pi i x_0 c/Q}}{\sqrt{QM}}\sum_{k=0}^{M-1}e^{2\pi i k r c/Q}.
$$
右侧的和是一个几何级数，可以写成
$$
S=\sum_{k=0}^{M-1}e^{2\pi i k r c/Q}
=\frac{1-e^{2\pi i M r c/Q}}{1-e^{2\pi i r c/Q}}.
$$
振幅的模方（即测得 $c$ 的概率）与 $|S|^2$ 成正比，利用三角函数恒等式可得
$$
|S|^2=\frac{\sin^2(\pi M r c/Q)}{\sin^2(\pi r c/Q)}.
$$

当分母 $\sin(\pi r c/Q)$ 接近 $0$ 时，分子通常不是同时为 $0$，因而概率出现尖峰。这正对应于
$$
\frac{r c}{Q}\approx \text{整数}\quad\Longleftrightarrow\quad c\approx \frac{kQ}{r}.
$$
也就是说，来自不同的项 $|x_0+kr\rangle$ 经过QFT后在这些 $c$ 点发生constructive interference，使得测得这些 $c$ 的概率显著增大；在离峰较远处则发生相消干涉，概率很小。

这就是为什么测量得到的 $c$ 很可能满足近似关系 $c/Q\approx k/r$，之后可用连分数法从该近似恢复分数 $k/r$ 以求出周期 $r$。

### 步骤6：测量第一寄存器

测量第一寄存器，得到整数$c$。根据QFT的性质，$c$很可能满足：

$$\left|\frac{c}{Q} - \frac{k}{r}\right| < \frac{1}{2Q}$$

其中$k$是某个整数。

这个式子是在网上查阅资料后得出的。具体的推导待更深入的研究后补充。

## 经典后处理

### 连分数算法

使用连分数算法从测量结果$c$推断周期$r$：

1. 计算$c/Q$的连分数展开
2. 尝试不同的收敛子找到可能的$r$
3. 验证$r$是否为函数$f(x) = a^x \mod N$的周期

如果成功找到了周期$r$，则我们可以使用前述方法计算出$N$的非平凡因子。

## 算法分析

### 复杂度分析

设$n$为$N$的位数：
- **时间复杂度**：$O(n^3)$
- **空间复杂度**：分解$n$位数$N$需要：
   - $O(n)$个量子比特
   - $O(n^3)$个量子门操作